#!/bin/sh -xe

yarn build

git config user.email "continuous.integration@intellihr.com.au"
git config user.name "IntelliHR CI"

echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" > .npmrc

npm version "$RELEASE_VERSION" -m "[ci skip] Upgrade to %s"
npm publish --access public

git remote add github "git@github.com:intellihr/ui-components.git" || true
git push --tags github

git pull --rebase github develop

sed -i -r "s/final def RELEASE_VERSION.*/final def RELEASE_VERSION = '$DEFAULT_RELEASE_VERSION'/" Jenkinsfile-new

git add Jenkinsfile-new
git commit -m "Reset to default release version $DEFAULT_RELEASE_VERSION" || true

git push github HEAD:develop
